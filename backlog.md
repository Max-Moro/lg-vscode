# Backlog — Listing Generator for VS Code

Документ с направлениями развития: фичи CLI, улучшения расширения, UX/качество жизни, производительность, тестирование и релизный процесс.  
Приоритизация: **P0** (критично для v1.0), **P1** (высокий приоритет), **P2** (желательно), **Icebox** (идеи на потом).  
Майлстоны ориентировочные: **v0.2**, **v0.3**, **v0.4**, **v1.0**.

---

## 1) CLI (JSON/сервисные команды и интеграция)

### 1.1 JSON-протокол расширения (P0, v0.2)
- [x] `--list-sections --json`
- [x] `--list-contexts --json`
- [x] `--list-included --json`
- [x] `--list-included --stats --json`
- [x] `--doctor --json`
- [x] `PROTOCOL_VERSION = 1`
- [ ] Единый формат ошибок: `{"error":{"kind":"...","message":"...","hint":"..."}}` + код выхода (P0).

### 1.2 Новые команды (P1, v0.3)
- `--validate-config --json` — валидировать `lg-cfg/config.yaml` и дать развёрнутые сообщения.  
- `--dump-effective-config --json` — показать «эффективный» конфиг (после мерджа дефолтов и overrides).  
- `--list-adapters --json` — зарегистрированные адаптеры и их опции.  
- `--preview-template NAME --json` — отрендерить шаблон без подстановки секций (для дебага).  
- `--explain PATH --json` — объяснить, почему файл включён/исключён (разбор по узлам фильтра).  
- `--estimate --paths file1 file2 ... --json` — оценка токенов для произвольного набора путей.  
- `--stats --sort path|size|share --json` — сортировка на стороне CLI.

### 1.3 Производительность и устойчивость (P1, v0.3)
- Стримовая токенизация (chunked) с прокидкой прогресса (опциональный `--progress`).  
- Таймлимиты и «мягкие отмены» (реакция на SIGINT).  
- Стабильные коды выхода: 0 ok; 2 config; 3 git; 4 schema; 5 template; 10 internal.

### 1.4 Документация (P2)
- Описание протокола JSON (схемы) в `docs/cli-protocol.md`.  
- Примеры команд и типовых ответов.

---

## 2) VS Code — UX и основные фичи

### 2.1 Панель управления (Control Panel) (P0, v0.2 → v0.3)
- [x] Базовые кнопки/селекторы + подсказки и иконки.
- [x] Память последних параметров (globalState).
- [ ] Кнопка **Re-run last** (+ горячая клавиша) (P0).
- [ ] Копировать результат в буфер (**Copy Listing / Copy Context**) (P0).
- [x] Кнопка «Открыть файл конфигурации» (`lg-cfg/config.yaml`) (P1).
- [ ] Состояние/ошибки поверх кнопок (inline alerts) (P1).
- [ ] Настраиваемые пресеты (комбинации секция/режим/шаблон) (P2).

### 2.2 Stats Webview (P1, v0.3)
- [x] Таблица из JSON.
- [ ] Сортировка по колонкам, фильтры, поиск.  
- [ ] Экспорт: **Copy as Markdown / CSV**.  
- [ ] Подсветка overflow > 100% и свёртка больших путей.  
- [ ] Переход к файлу из строки таблицы.

### 2.3 Included Files View (P1)
- [ ] Отметки файлов по типам (иконки/цвет).  
- [ ] Быстрые фильтры (по расширениям/папкам).  
- [ ] Контекстное меню: «Скопировать путь», «Открыть в новой группе».

### 2.4 Настройки и онбординг (P1)
- [ ] Мастер первой настройки: выбрать стратегию установки CLI, интерпретатор/путь.  
- [ ] Индикация состояния CLI (managed/system, версия) в статус-баре.  
- [ ] Кнопка «Update CLI» для managed-venv.

### 2.5 Интеграция с Python-расширением (P1, v0.4)
- [ ] Получение активного интерпретатора через API Python-расширения.  
- [ ] Предложение переключиться на активное окружение.

### 2.6 YAML-схема и валидация (P0, v0.3)
- [ ] JSON-schema для `lg-cfg/config.yaml` (подсказки по полям, примеры, линтинг).  
- [ ] Jump-to-definition для секций/плейсхолдеров в шаблонах (P2).

### 2.7 Remote/WSL/Containers (P1)
- [ ] Установка CLI на удалённой стороне (managed-venv remote).  
- [ ] Диагностика прокси/сертификатов.

### 2.8 Доступность/локализация (P2)
- [ ] Полная клавиатурная навигация в панели.  
- [ ] i18n: en/ru.

---

## 3) Надёжность и производительность расширения

- [ ] Отмена длительных операций (CancellationToken) (P1).  
- [ ] Лимиты на размер вывода (safeguards) и «отложенное рендеринг» больших документов (P1).  
- [ ] Кэширование `--list-sections` / `--list-contexts` (invalidate по изменению файлов) (P2).  
- [ ] Тонкая обработка ошибок CLI: парсинг `error.kind`, подсказки action-button (P0).

---

## 4) Тестирование и CI

- [ ] Юнит-тесты TS: парсинг JSON, раннер, редьюсеры состояния (P1).  
- [ ] Интеграционные тесты через `@vscode/test-electron` (пакет команд и webview) (P1).  
- [ ] Фикстурные репозитории (docs, python-pkg, mono-repo, «грязный Git») (P1).  
- [ ] GitHub Actions: билд, линт, тесты на Win/Linux/macOS (P0).  
- [ ] Публикация `.vsix` артефакта и upload в Marketplace/Open VSX (P0).

---

## 5) Релизы и распространение

- [ ] Автосборка `vsce package` и публикация `ovsx publish` (P0).  
- [ ] Changelog и релизные заметки (P0).  
- [ ] Версионирование протокола (минимальная требуемая версия CLI для конкретного релиза расширения) (P0).

---

## 6) Безопасность

- [ ] Поддержка Workspace Trust (не запускать внешние процессы в недоверенных рабочих пространствах) (P0).  
- [ ] Проверка путей/аргументов перед спавном процесса (P0).  
- [ ] Минимизация прав при создании managed-venv (P1).

---

## 7) Идеи и улучшения UI/UX (Icebox / P2)

- Мини-лог последних операций в нижней части панели.  
- «Quick Actions» по файлу в Included-дереве: «исключить/добавить в filters» с автопатчем `config.yaml`.  
- Превью шаблонов (рендер `.tpl.md` с подсветкой плейсхолдеров).  
- Привязка хоткеев на «Generate Listing / Context».  
- Бейдж в панели с количеством файлов/объёмом токенов.

---

## 8) Out-of-Scope (сейчас не планируется)

- Встроенный редактор YAML с автогенерацией секций (оставим стандартным YAML-плагинам).  
- Автоматическое коммитирование сгенерированных листингов.  
- Редактирование контента виртуальных документов с записью обратно в шаблоны.

---

## Шаблон карточки задачи

```md
### [ID] Короткое название
**Приоритет:** P0/P1/P2 • **Майлстоун:** v0.2/v0.3/v1.0  
**Описание:** что именно делаем и зачем, кратко.  
**Пользовательская ценность:** как это улучшит UX/скорость/надёжность.  
**API/CLI:** команды, флаги, JSON-схемы, ошибки.  
**UI/UX:** макеты, тексты, иконки.  
**Готово, когда:** измеримые критерии (acceptance).  
**Риски/зависимости:** внешние плагины, права, библиотека.  
**Оценка:** S/M/L/XL.
````

---

## Быстрый план до v1.0

* **v0.2**: JSON-канал в расширении, Control Panel, базовая статистика, Doctor.
* **v0.3**: YAML-схема, сортируемая таблица, экспорт, Re-run last, улучшенный онбординг.
* **v0.4**: Python-API интеграция, Remote/WSL, авто-обновление managed-CLI.
* **v1.0**: шлифовка UX, покрытие тестами и публикация в Marketplace/Open VSX.
