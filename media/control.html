<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'none';
                   style-src {{cspSource}};
                   font-src {{cspSource}};
                   img-src data:;
                   script-src 'nonce-{{nonce}}';">
    <link rel="stylesheet" href="{{codiconsUri}}">
    <link rel="stylesheet" href="{{baseCssUri}}">
    <link rel="stylesheet" href="{{lgUiCssUri}}">
    <link rel="stylesheet" href="{{controlCssUri}}">
  </head>
  <body data-vscode-theme-kind="">
    <div class="block">
      <h3><span class="codicon codicon-run"></span>AI Contexts</h3>
      
      <!-- Task Context Field -->
      <div class="row task-context-row">
        <textarea
          id="taskText"
          class="lg-chat-input"
          data-state-key="taskText"
          placeholder="Describe current task"
          rows="1"></textarea>
      </div>
      
      <div class="row">
        <span class="cluster">
          <select id="template" class="lg-select grow" data-state-key="template" title="Context (.ctx.md) from lg-cfg/"></select>
          <button class="lg-btn" data-action="sendToAI" title="Generate context and send to AI">
            <span class="codicon codicon-send"></span><span class="btn-text">Send to AI</span>
          </button>
          <button class="lg-btn" id="btn-context" data-action="generateContext" title="Generate context prompt from template">
            <span class="codicon codicon-file-code"></span><span class="btn-text">Generate Context</span>
          </button>
        </span>
        <span class="cluster">
          <button class="lg-btn lg-btn--primary" data-action="showContextStats" title="Show cumulative token statistics for selected context">
            <span class="codicon codicon-table"></span><span class="btn-text">Show Context Stats</span>
          </button>
        </span>
      </div>
    </div>

    <div class="block">
      <h3><span class="codicon codicon-settings-gear"></span> Adaptive Settings</h3>
      <div id="mode-sets-row" class="row">
        <!-- Mode sets and target branch will be populated here dynamically -->
      </div>

      <div class="row">
        <span class="cluster">
          <button class="lg-btn" id="tags-toggle" data-action="toggleTags" title="Configure tags">
            <span class="codicon codicon-tag"></span><span class="btn-text">Configure Tags</span>
          </button>
        </span>
      </div>
    </div>

    <!-- Tags panel (initially hidden) -->
    <div id="tags-panel" class="tags-panel" style="display: none;">
      <div class="tags-panel-header">
        <h3><span class="codicon codicon-tag"></span> Tags Configuration</h3>
        <button class="lg-btn tags-close" id="tags-close" title="Close tags panel">
          <span class="codicon codicon-close"></span>
        </button>
      </div>
      <div id="tag-sets-container" class="tag-sets-container">
        <!-- Tag sets will be populated here -->
      </div>
    </div>

    <div class="block">
      <h3><span class="codicon codicon-graph"></span> Inspect</h3>
      <div class="row">
        <span class="cluster" title="Section from lg-cfg/sections.yaml or *.sec.yaml">
          <label>Section:</label>
          <select class="lg-select" id="section" data-state-key="section"></select>
        </span>

      </div>
      <div class="row">
        <span class="cluster">
          <button class="lg-btn" data-action="showIncluded" title="Show which files pass the filters">
            <span class="codicon codicon-list-tree"></span><span class="btn-text">Show Included</span>
          </button>
        </span>
        <span class="cluster">
          <button class="lg-btn" data-action="generateListing" title="Combine source files from selected section into a single listing">
           <span class="codicon codicon-file-code"></span><span class="btn-text">Generate Listing</span>
          </button>
        </span>
        <span class="cluster">
          <button class="lg-btn" data-action="showStats" title="Table of sizes and tokens with context shares">
            <span class="codicon codicon-table"></span><span class="btn-text">Show Stats</span>
          </button>
        </span>
      </div>
    </div>

    <div class="block">
      <h3><span class="codicon codicon-symbol-unit"></span> Tokenization Settings</h3>
      
      <!-- Tokenization library -->
      <div class="row">
        <span class="cluster" title="Tokenization library (tiktoken, tokenizers, sentencepiece)">
          <label>Library:</label>
          <select class="lg-select" id="tokenizerLib" data-state-key="tokenizerLib"></select>
        </span>

        <!-- Encoder (depends on library) -->
        <span class="cluster" title="Encoder or tokenization model">
          <label for="encoder">Encoder:</label>
          <input
            type="text"
            id="encoder"
            data-state-key="encoder"
            class="lg-input"
            placeholder="Enter encoder name"
            autocomplete="off"
          />
        </span>

        <!-- Context window size -->
        <span class="cluster" title="Context window size in tokens">
          <label>Context Limit:</label>
          <input type="number" id="ctxLimit" data-state-key="ctxLimit"
            class="lg-input lg-input--number"
            min="1000" max="2000000" step="1000"
            placeholder="128000" />
        </span>
      </div>
    </div>

    <!-- CLI Settings Block (shown only when CLI-based provider is selected) -->
    <div id="cli-settings-block" class="block" style="display: none;">
      <h3><span class="codicon codicon-terminal"></span> CLI Provider Settings</h3>
      
      <div class="row">
        <span class="cluster" title="Relative path from workspace root (empty = root, e.g. 'backend', 'services/api')">
          <label>Scope:</label>
          <input
            type="text"
            id="cliScope"
            data-state-key="cliScope"
            class="lg-input"
            autocomplete="off"
          />
        </span>
        <span class="cluster" title="Terminal shell type for CLI execution">
          <label>Shell:</label>
          <select class="lg-select" id="cliShell" data-state-key="cliShell"></select>
        </span>
      </div>
      
      <!-- Claude-specific settings (shown only for Claude CLI provider) -->
      <div id="claude-settings-container" class="row" style="display: none;">
        <span class="cluster" title="Claude model family">
          <label>Model:</label>
          <select class="lg-select" id="claudeModel" data-state-key="claudeModel"></select>
        </span>
        <span class="cluster" title="Integration method with Claude Code">
          <label>Method:</label>
          <select class="lg-select" id="claudeIntegrationMethod" data-state-key="claudeIntegrationMethod"></select>
        </span>
      </div>

      <!-- Codex-specific settings (shown only for Codex CLI provider) -->
      <div id="codex-settings-container" class="row" style="display: none;">
        <span class="cluster" title="Reasoning depth level (affects response time and quality)">
          <label>Reasoning:</label>
          <select class="lg-select" id="codexReasoningEffort" data-state-key="codexReasoningEffort"></select>
        </span>
      </div>
    </div>

    <script nonce="{{nonce}}" src="{{lgUiJsUri}}"></script>
    <script nonce="{{nonce}}" src="{{controlJsUri}}"></script>
  </body>
</html>
