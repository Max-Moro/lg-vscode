<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'none';
                   style-src {{cspSource}};
                   font-src {{cspSource}};
                   img-src data:;
                   script-src 'nonce-{{nonce}}';">
    <link rel="stylesheet" href="{{codiconsUri}}">
    <link rel="stylesheet" href="{{baseCssUri}}">
    <link rel="stylesheet" href="{{controlCssUri}}">
  </head>
  <body data-vscode-theme-kind="">
    <div class="block">
      <h3><span class="codicon codicon-run"></span>AI Contexts</h3>
      
      <!-- Task Context Field -->
      <div class="row task-context-row">
        <div class="task-context-wrapper">
          <textarea 
            id="taskText" 
            class="task-context-field"
            data-state-key="taskText"
            placeholder="Describe current task"
            rows="2"></textarea>
        </div>
      </div>
      
      <div class="row">
        <span class="cluster">
          <select id="template" class="grow" data-state-key="template" title="Контекст (.ctx.md) из lg-cfg/"></select>
          <button data-action="sendContextToAI" title="Сгенерировать контекст и отправить в AI">
            <span class="codicon codicon-send"></span><span class="btn-text">Send to AI</span>
          </button>
          <button id="btn-context" data-action="generateContext" title="Сгенерировать контекст-промт по шаблону">
            <span class="codicon codicon-file-code"></span><span class="btn-text">Generate Context</span>
          </button>
        </span>
        <span class="cluster">
          <button class="btn-primary" data-action="showContextStats" title="Показать суммарную статистику токенов для выбранного контекста">
            <span class="codicon codicon-table"></span><span class="btn-text">Show Context Stats</span>
          </button>
        </span>
      </div>
    </div>

    <div class="block">
      <h3><span class="codicon codicon-settings-gear"></span> Adaptive Settings</h3>
      <div id="mode-sets-container" class="mode-sets-container">
        <!-- Mode sets will be populated here -->
      </div>
      <div class="row">
        <span class="cluster">
          <button id="tags-toggle" data-action="toggleTags" title="Configure tags">
            <span class="codicon codicon-tag"></span><span class="btn-text">Configure Tags</span>
          </button>
        </span>
      </div>
    </div>

    <!-- Tags panel (initially hidden) -->
    <div id="tags-panel" class="tags-panel" style="display: none;">
      <div class="tags-panel-header">
        <h3><span class="codicon codicon-tag"></span> Tags Configuration</h3>
        <button id="tags-close" class="tags-close" title="Close tags panel">
          <span class="codicon codicon-close"></span>
        </button>
      </div>
      <div id="tag-sets-container" class="tag-sets-container">
        <!-- Tag sets will be populated here -->
      </div>
    </div>

    <div class="block">
      <h3><span class="codicon codicon-graph"></span> Inspect</h3>
      <div class="row">
        <span class="cluster" title="Секция из lg-cfg/sections.yaml или *.sec.yaml">
          <label>Section:</label>
          <select id="section" data-state-key="section"></select>
        </span>

      </div>
      <div class="row">
        <span class="cluster">
          <button data-action="showIncluded" title="Показать какие файлы проходят фильтры">
            <span class="codicon codicon-list-tree"></span><span class="btn-text">Show Included</span>
          </button>
        </span>
        <span class="cluster">
          <button data-action="generateListing" title="Сшить исходники из выбранной секции в единый листинг">
           <span class="codicon codicon-file-code"></span><span class="btn-text">Generate Listing</span>
          </button>
          <button data-action="sendListingToAI" title="Сгенерировать листинг и отправить в AI">
            <span class="codicon codicon-send"></span><span class="btn-text">Send to AI</span>
          </button>
        </span>
        <span class="cluster">
          <button data-action="showStats" title="Таблица размеров и токенов с долями контекста">
            <span class="codicon codicon-table"></span><span class="btn-text">Show Stats</span>
          </button>
        </span>
      </div>
    </div>

    <div class="block">
      <h3><span class="codicon codicon-organization"></span> Project Scope</h3>
      <div class="row">
        <span class="cluster" title="Параметры для расчета статистики">
          <label class="muted">Model:</label>
          <select id="model" data-state-key="model"></select>
        </span>
      </div>
    </div>

    <div class="block">
      <h3><span class="codicon codicon-tools"></span> Utilities</h3>
      <div class="row">
        <span class="cluster">
          <button data-action="createStarter" title="Создать lg-cfg/sections.yaml и примеры .tpl.md/.ctx.md">
             <span class="codicon codicon-new-file"></span><span class="btn-text">Create Starter Config</span>
          </button>
          <button data-action="openConfig" title="Открыть lg-cfg/sections.yaml">
           <span class="codicon codicon-file"></span><span class="btn-text">Open Config</span>
          </button>
        </span>
        <span class="cluster">
          <button data-action="doctor" title="Проверка окружения и конфигурации">
            <span class="codicon codicon-pulse"></span><span class="btn-text">Doctor</span>
          </button>
          <button data-action="resetCache" title="Сбросить кеш Listing Generator">
            <span class="codicon codicon-trash"></span><span class="btn-text">Reset Cache</span>
          </button>
          <button data-action="openSettings" title="Открыть настройки расширения">
            <span class="codicon codicon-gear"></span><span class="btn-text">Settings</span>
          </button>
        </span>
      </div>
    </div>
    <script nonce="{{nonce}}" src="{{commonUiJsUri}}"></script>
    <script nonce="{{nonce}}" src="{{controlJsUri}}"></script>
  </body>
</html>
